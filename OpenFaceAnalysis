---
title: 'All Data Analysis on the Facial Expression/Cortisol Project'
author: "Julianna Calabrese"
date: "Last knitted: `r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 4
    collapse: subsection
    theme: united
    highlight: tango
  pdf_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(mosaic)
library(ggplot2)
library(tidyr)
library(dplyr)
library(psych)
library(nlme)
library(plyr)
library(Hmisc)
library(rmarkdown)
library(yaml)
library(rapportools)
library(lavaan)
library(lme4)
library(corrr)
library(corrplot)
library(reshape2)
library(lmerTest)
library(multcomp)
library(optimx)
library(MuMIn)
library(Rmisc)
library(jsonlite)
library(knitr)
library(taRifx)
library(papeR)
library(stargazer)
library(kableExtra)
library(broom)
library(xtable)
library(sjPlot)
library(sjstats)
library(sjlabelled)
library(sjmisc)
library(ggeffects)
library(glmmTMB)
library(bindrcpp)
library(pbkrtest)
library(devtools)
library(psycholing)
library(pander)
library(coefplot)
library(ggiraphExtra)
library(languageR)
library(aod)
```

```{r Load in data, include=FALSE}
cp_long <- read.csv(file="C:/Users/jrcala/Documents/My Research/RStudio/cp_long.csv", header=TRUE, sep=",")
#cp_long <- read.csv(file="/Users/Julianna/Desktop/data/cp_long.csv", header=TRUE, sep=",")
cp_long$X <- NULL
cp_long$gender <- as.integer(cp_long$gender)
cp_long$gendercat <- as.character(cp_long$gendercat)
cp_long$male <- as.integer(cp_long$male)
cp_long$female <- as.integer(cp_long$female)
cp_long$baseline <- as.numeric(cp_long$cort_baseline_Win)
cp_long$baselineC <- as.numeric(cp_long$cort_baseline_WinC)
cp_long$id <- as.factor(cp_long$id)
cp_long$timebeforepeak <- as.integer(cp_long$timebeforepeak)
cp_long$timeafterpeak <- as.integer(cp_long$timeafterpeak)
cp_long$ThreatCompc <- cp_long$ThreatComp - mean(cp_long$ThreatComp)
cp_long$DepCompc <- cp_long$DepComp - mean(cp_long$DepComp)
cp_long$ThreatDepInt <- cp_long$ThreatCompc*cp_long$DepCompc
ctrl <- lmeControl(opt='optim')
```

## Introduction

Since Lopez-Duran, Mayer, & Abelson's 2014 paper utilized the PROC MIXED command in SAS, this RMarkdown file will use the lme() command as part of the nlme package. More information about nlme() can be found [here](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.130.1698&rep=rep1&type=pdf).

### Equation from Lopez-Duran 2014

$\begin{aligned}
Cortisol = \beta_0  
& + \beta_1 \cdot Sex \\
& + \beta_2 \cdot TimeBeforePeak \\
& + \beta_3 \cdot TimeAfterPeak \\
& + \beta_4 \cdot Sex \cdot TimeBeforePeak \\
& + \beta_5 \cdot Sex \cdot TimeAfterPeak \\
\end{aligned}$

### My Base Model Equation

$\begin{aligned}
Cortisol = \beta_0  
& + \beta_1 \cdot TimeBeforePeak \\
& + \beta_2 \cdot TimeAfterPeak \\
& + \beta_3 \cdot Baseline \\
& + \mu \cdot Subject \\
& + \epsilon \\
\end{aligned}$

```{r results='asis', warning=FALSE, message=FALSE, echo=FALSE, include=FALSE}
corr_vars <- data.frame(cp_long$angerC, cp_long$fearC, cp_long$happinessC, cp_long$sadnessC, cp_long$painC, cp_long$ctqsumC, cp_long$emosumC, cp_long$ThreatZSum, cp_long$DepZSum, cp_long$ThreatCompc, cp_long$DepCompc, cp_long$ThreatDepInt, cp_long$Responder)

names(corr_vars) <- gsub(pattern = "cp_long._*", replacement = "", x = names(corr_vars))

corr_data <- stats::cor(corr_vars)

labels <- c("Anger", "Fear", "Happiness", "Sadness", "Pain", "CTQ Total", "CTQ Emo", "ThreatZSum", "DepZSum", "ThreapCompc", "DepCompc", "ThreatDepInt", "Responder")

set_theme(axis.title.size = 0, geom.label.size = 4.5, axis.textsize.x = 1, axis.textsize.y = 1, axis.angle.x = 90)

sjp.corr(corr_data, corr.method=c("spearman"),title="Correlation Matrix", na.deletion = "pairwise", sort.corr=FALSE, show.values=TRUE, decimals=2, axis.labels = labels)

rm(corr_vars)
rm(corr_data)
rm(labels)
```

```{r results='asis', warning=FALSE, message=FALSE, echo=FALSE, include=FALSE}
corr_vars <- data.frame(cp_long$AU01_r, cp_long$AU02_r, cp_long$AU04_r, cp_long$AU05_r, cp_long$AU06_r, cp_long$AU07_r, cp_long$AU09_r, cp_long$AU10_r, cp_long$AU12_r, cp_long$AU14_r, cp_long$AU15_r, cp_long$AU17_r, cp_long$AU20_r, cp_long$AU23_r, cp_long$AU25_r, cp_long$AU26_r, cp_long$ctqsumC,cp_long$ThreatCompc, cp_long$DepCompc, cp_long$Responder)

names(corr_vars) <- gsub(pattern = "cp_long._*", replacement = "", x = names(corr_vars))

corr_data <- stats::cor(corr_vars)

labels <- c("AU1", "AU2", "AU4", "AU5", "AU6", "AU7", "AU9", "AU10", "AU12", "AU14", "AU15", "AU17", "AU20", "AU23", "AU25", "AU26", "CTQ Total", "ThreapCompc", "DepCompc", "Responder")

set_theme(axis.title.size = 0, geom.label.size = 4.5, axis.textsize.x = 1, axis.textsize.y = 1, axis.angle.x = 90)

sjp.corr(corr_data, corr.method=c("spearman"),title="Correlation Matrix", na.deletion = "pairwise", sort.corr=FALSE, show.values=TRUE, decimals=2, axis.labels = labels)

rm(corr_vars)
rm(corr_data)
rm(labels)
```

## Base Model

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
base <- lme(cortvalue ~
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline, # Fixed effect
            random = ~1|id, # Random intercept for Subject
            corr = corAR1(), # Specifies AR1 structure
            method = "REML", # Specifies REML fit
            data = cp_long)
```

```{r include=FALSE}
summary(base)

colorder <- c("est", "se", "p")

labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline")
```

```{r echo=FALSE, results = 'asis'}
tab_model(base, title = "Base Model",
          dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3,
          emph.p = TRUE,
          show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE,
          show.std=NULL,
          show.df = TRUE, string.df="DF", p.val = "wald",
          show.stat = TRUE, string.stat = "T",          
          show.est = TRUE, # No string.est
          show.se = TRUE, string.se="Std Error",
          show.p = TRUE, string.p="P-value",
          show.r2 = TRUE,
          col.order=colorder)
```

## Emotion Models

### Anger

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
anger <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            angerC + angerC*timebeforepeak + angerC*timeafterpeak + angerC*baseline, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(anger)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Anger", "Anger * TimeBeforePeak", "Anger * TimeAfterPeak", "Anger * Baseline")

colorder <- c("est", "se", "p")

tab_model(anger, title = "Anger Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)
```

### Fear

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
fear <- lme(cortvalue ~
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            fearC + fearC*timebeforepeak + fearC*timeafterpeak + fearC*baseline, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(fear)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Fear", "Fear * TimeBeforePeak", "Fear * TimeAfterPeak", "Fear * Baseline")

colorder <- c("est", "se", "p")

tab_model(fear, title = "Fear Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)
```

### Happiness

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
happiness <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            happinessC + happinessC*timebeforepeak + happinessC*timeafterpeak + happinessC*baseline, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(happiness)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Happiness", "Happiness * TimeBeforePeak", "Happiness * TimeAfterPeak", "Happiness * Baseline")

colorder <- c("est", "se", "p")

tab_model(happiness, title = "Happy Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)
```

### Sadness

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
sadness <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            sadnessC + sadnessC*timebeforepeak + sadnessC*timeafterpeak + sadnessC*baseline, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(sadness)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Sadness", "Sadness * TimeBeforePeak", "Sadness * TimeAfterPeak", "Sadness * Baseline")

colorder <- c("est", "se", "p")

tab_model(sadness, title = "Sad Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)
```

### Pain

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
pain <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            painC + painC*timebeforepeak + painC*timeafterpeak + painC*baseline, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(pain)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Pain", "Pain * TimeBeforePeak", "Pain * TimeAfterPeak", "Pain * Baseline")

colorder <- c("est", "se", "p")

tab_model(pain, title = "Pain Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)
```

## Trauma Models

### CTQ Total Sum

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
ctq <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            ctqsumC + ctqsumC*timebeforepeak + ctqsumC*timeafterpeak + ctqsumC*baseline, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), #specifies AR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(ctq)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "CTQ", "CTQ * TimeBeforePeak", "CTQ * TimeAfterPeak", "CTQ * Baseline")

colorder <- c("est", "se", "p")

tab_model(ctq, title = "CTQ Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)
```

### ThreatZSum

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
ThreatZSum <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            ThreatZSum + ThreatZSum*timebeforepeak + ThreatZSum*timeafterpeak + ThreatZSum*baseline, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(ThreatZSum)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "ThreatZSum", "ThreatZSum * TimeBeforePeak", "ThreatZSum * TimeAfterPeak", "ThreatZSum * Baseline")

colorder <- c("est", "se", "p")

tab_model(ThreatZSum, title = "ThreatZSum Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)
```

### ThreatComp

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
ThreatComp <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            ThreatComp + ThreatComp*timebeforepeak + ThreatComp*timeafterpeak + ThreatComp*baseline, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(ThreatComp)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "ThreatComp", "ThreatComp * TimeBeforePeak", "ThreatComp * TimeAfterPeak", "ThreatComp * Baseline")

colorder <- c("est", "se", "p")

tab_model(ThreatComp, title = "ThreatComp Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)
```

### DepZSum

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
DepZSum <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            DepZSum + DepZSum*timebeforepeak + DepZSum*timeafterpeak + DepZSum*baseline, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(DepZSum)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "DepZSum", "DepZSum * TimeBeforePeak", "DepZSum * TimeAfterPeak", "DepZSum * Baseline")

colorder <- c("est", "se", "p")

tab_model(DepZSum, title = "DepZSum Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)
```

### DepComp

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
DepComp <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            DepComp + DepComp*timebeforepeak + DepComp*timeafterpeak + DepComp*baseline, # Interactions
            random = ~1|id, # Random slopes but not intercepts 
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(DepComp)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "DepComp", "DepComp * TimeBeforePeak", "DepComp * TimeAfterPeak", "Depcomp * Baseline")

colorder <- c("est", "se", "p")

tab_model(DepComp, title = "DepComp Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)
```

### ThreatCompc

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
ThreatCompc <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            ThreatCompc + ThreatCompc*timebeforepeak + ThreatCompc*timeafterpeak + ThreatCompc*baseline, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(ThreatCompc)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "ThreatCompc", "ThreatCompc * TimeBeforePeak", "ThreatCompc * TimeAfterPeak", "ThreatCompc * Baseline")

colorder <- c("est", "se", "p")

tab_model(ThreatCompc, title = "ThreatCompc Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)
```

### DepCompc

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
DepCompc <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            DepCompc + DepCompc*timebeforepeak + DepCompc*timeafterpeak + DepCompc*baseline, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(DepCompc)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "DepCompc", "DepCompc * TimeBeforePeak", "DepCompc * TimeAfterPeak", "Depcompc * Baseline")

colorder <- c("est", "se", "p")

tab_model(DepCompc, title = "DepCompc Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)
```

### ThreatDepInt

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
ThreatDepInt <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            ThreatDepInt + ThreatDepInt*timebeforepeak + ThreatDepInt*timeafterpeak + ThreatDepInt*baseline, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(ThreatDepInt)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "ThreatDepInt", "ThreatDepInt * TimeBeforePeak", "ThreatDepInt * TimeAfterPeak", "ThreatDepInt * Baseline")

colorder <- c("est", "se", "p")

tab_model(ThreatDepInt, title = "ThreatDepInt Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)
```

## Interaction Models

Please note that not everything below is meaningful. I just didn't want to delete failed attempts. 

### Anger X CTQ Total

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            angerC + ctqsumC + # Fixed effect
            angerC*timebeforepeak + angerC*timeafterpeak + angerC*baseline + # Interactions
            angerC*ctqsumC, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Anger", "CTQ Total",
            "Anger * TimeBeforePeak", "Anger * TimeAfterPeak", "Anger * Baseline",
            "Anger * CTQ Total")

colorder <- c("est", "se", "p")

tab_model(mod, title = "Anger X CTQ Total Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### Anger X ThreatCompc

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            angerC + ThreatCompc + # Fixed effect
            angerC*timebeforepeak + angerC*timeafterpeak + angerC*baseline + # Interactions
            angerC*ThreatCompc, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Anger", "ThreatCompc",
            "Anger * TimeBeforePeak", "Anger * TimeAfterPeak", "Anger * Baseline",
            "Anger * ThreatCompc")

colorder <- c("est", "se", "p")

tab_model(mod, title = "Anger X ThreatCompc Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### Fear X CTQ Total

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            fearC + ctqsumC + # Fixed effect
            fearC*timebeforepeak + fearC*timeafterpeak + fearC*baseline + # Interactions
            fearC*ctqsumC, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Fear", "CTQ Total",
            "Fear * TimeBeforePeak", "Fear * TimeAfterPeak", "Fear * Baseline",
            "Fear * CTQ Total")

colorder <- c("est", "se", "p")

tab_model(mod, title = "Fear X CTQ Total Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### Fear X ThreatCompc

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            fearC + ThreatCompc + # Fixed effect
            fearC*timebeforepeak + fearC*timeafterpeak + fearC*baseline + # Interactions
            fearC*ThreatCompc, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Fear", "ThreatCompc",
            "Fear * TimeBeforePeak", "Fear * TimeAfterPeak", "Fear * Baseline",
            "Fear * ThreatCompc")

colorder <- c("est", "se", "p")

tab_model(mod, title = "Fear X ThreatCompc Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### Happiness X CTQ Total

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            happinessC + ctqsumC + # Fixed effect
            happinessC*timebeforepeak + happinessC*timeafterpeak + happinessC*baseline + # Interactions
            happinessC*ctqsumC, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Happiness", "CTQ Total",
            "Happiness * TimeBeforePeak", "Happiness * TimeAfterPeak", "Happiness * Baseline",
            "Happiness * CTQ Total")

colorder <- c("est", "se", "p")

tab_model(mod, title = "Happiness X CTQ Total Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### Happiness X ThreatCompc

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            happinessC + ThreatCompc + # Fixed effect
            happinessC*timebeforepeak + happinessC*timeafterpeak + happinessC*baseline + # Interactions
            happinessC*ThreatCompc, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Happiness", "ThreatCompc",
            "Happiness * TimeBeforePeak", "Happiness * TimeAfterPeak", "Happiness * Baseline",
            "Happiness * ThreatCompc")

colorder <- c("est", "se", "p")

tab_model(mod, title = "Anger X ThreatCompc Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### Sadness X CTQ Total

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            sadnessC + ctqsumC + # Fixed effect
            sadnessC*timebeforepeak + sadnessC*timeafterpeak + sadnessC*baseline + # Interactions
            sadnessC*ctqsumC, # Interactions
            random = ~1|id, # Random slopes but not intercepts  
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Sadness", "CTQ Total",
            "Sadness * TimeBeforePeak", "Sadness * TimeAfterPeak", "Sadness * Baseline",
            "Sadness * CTQ Total")

colorder <- c("est", "se", "p")

tab_model(mod, title = "Sadness X CTQ Total Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### Sadness X ThreatCompc

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            sadnessC + ThreatCompc + # Fixed effects
            sadnessC*timebeforepeak + sadnessC*timeafterpeak + sadnessC*baseline + # Interactions
            sadnessC*ThreatCompc, # Interactions
            random = ~1|id, # Random slopes but not intercepts 
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Sadness", "ThreatCompc",
            "Sadness * TimeBeforePeak", "Sadness * TimeAfterPeak", "Sadness * Baseline",
            "Sadness * ThreatCompc")

colorder <- c("est", "se", "p")

tab_model(mod, title = "Sadness X ThreatCompc Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### Pain X CTQ Total

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            painC + ctqsumC + # Fixed effects
            painC*timebeforepeak + painC*timeafterpeak + painC*baseline + # Interactions
            painC*ctqsumC, # Interaction
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Pain", "ThreatCompc",
            "Pain * TimeBeforePeak", "Pain * TimeAfterPeak", "Pain * Baseline",
            "Pain * ThreatCompc")

colorder <- c("est", "se", "p")

tab_model(mod, title = "Pain X CTQ Total Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### Pain X ThreatCompc

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + # Fixed effect
            painC + painC*timebeforepeak + painC*timeafterpeak + painC*baseline + # Interactions
            painC*ThreatCompc, # Interaction
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "Pain", "ThreatCompc",
            "Pain * TimeBeforePeak", "Pain * TimeAfterPeak", "Pain * Baseline",
            "Pain * ThreatCompc")

colorder <- c("est", "se", "p")

tab_model(mod, title = "Pain X ThreatCompc Model Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

## Action Unit Models

### AU5 Model X CTQ Total

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + ctqsumC + # Fixed effects
            AU05_r*timebeforepeak + AU05_r*timeafterpeak + AU05_r*baseline + AU05_r*ctqsumC, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "CTQ Total", "AU5", "TimeBeforePeak * AU5", "TimeAfterPeak * AU5", "Baseline * AU5", "CTQ Total * AU5")

colorder <- c("est", "se", "p")

tab_model(mod, title = "AU5 Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### AU6 Model X CTQ Total

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + ctqsumC + # Fixed effects
            AU06_r*timebeforepeak + AU06_r*timeafterpeak + AU06_r*baseline + AU06_r*ctqsumC, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "CTQ Total", "AU6", "TimeBeforePeak * AU6", "TimeAfterPeak * AU6", "Baseline * AU6", "CTQ Total * AU6")

colorder <- c("est", "se", "p")

tab_model(mod, title = "AU6 Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### AU6 Model X ThreatCompc

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + ThreatCompc + # Fixed effects
            AU06_r*timebeforepeak + AU06_r*timeafterpeak + AU06_r*baseline + AU06_r*ThreatCompc, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "ThreatCompc", "AU6", "TimeBeforePeak * AU6", "TimeAfterPeak * AU6", "Baseline * AU6", "ThreatCompc * AU6")

colorder <- c("est", "se", "p")

tab_model(mod, title = "AU6 Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### AU9 Model X CTQ Total

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + ctqsumC +
            AU09_r*timebeforepeak + AU09_r*timeafterpeak + AU09_r*baseline + AU09_r*ctqsumC,
            random = ~1|id, # Random slopes but not intercepts 
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "CTQ Total", "AU9", "TimeBeforePeak * AU9", "TimeAfterPeak * AU9", "Baseline * AU9", "CTQ Total * AU9")

colorder <- c("est", "se", "p")

tab_model(mod, title = "AU9 X CTQ Total Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### AU9 Model X ThreatCompc

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + ThreatCompc + # Fixed effects
            AU09_r*timebeforepeak + AU09_r*timeafterpeak + AU09_r*baseline + AU09_r*ThreatCompc, # Interactions
            random = ~1|id, # Random slopes but not intercepts
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "ThreatCompc", "AU9", "TimeBeforePeak * AU9", "TimeAfterPeak * AU9", "Baseline * AU9", "ThreatCompc * AU9")

colorder <- c("est", "se", "p")

tab_model(mod, title = "AU9 X ThreatCompc Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### AU14 Model X CTQ Total

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + ctqsumC + # Fixed effects
            AU14_r*timebeforepeak + AU14_r*timeafterpeak + AU14_r*baseline + AU14_r*ctqsumC, # Interactions
            random = ~1|id, # Random slopes but not intercepts  
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "CTQ Total", "AU14", "TimeBeforePeak * AU14", "TimeAfterPeak * AU14", "Baseline * AU14", "CTQ Total * AU14")

colorder <- c("est", "se", "p")

tab_model(mod, title = "AU14 X CTQ Total Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### AU14 Model X ThreatCompc

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + ThreatCompc + # Fixed effects
            AU14_r*timebeforepeak + AU14_r*timeafterpeak + AU14_r*baseline + AU14_r*ThreatCompc,
            random = ~1|id, # Random slopes but not intercepts 
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "ThreatCompc", "AU14", "TimeBeforePeak * AU14", "TimeAfterPeak * AU14", "Baseline * AU14", "ThreatCompc * AU14")

colorder <- c("est", "se", "p")

tab_model(mod, title = "AU14 X ThreatCompc Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### AU15 Model X ThreatCompc

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + ThreatCompc + # Fixed effects
            AU15_r*timebeforepeak + AU15_r*timeafterpeak + AU15_r*baseline + AU15_r*ThreatCompc,
            random = ~1|id, # Random slopes but not intercepts 
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "ThreatCompc", "AU15", "TimeBeforePeak * AU15", "TimeAfterPeak * AU15", "Baseline * AU15", "ThreatCompc * AU15")

colorder <- c("est", "se", "p")

tab_model(mod, title = "AU15 X ThreatCompc Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### AU20 Model X CTQ Total

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + ctqsumC + # Fixed effects
            AU20_r*timebeforepeak + AU20_r*timeafterpeak + AU20_r*baseline + AU20_r*ctqsumC, # Interactions
            random = ~1|id, # Random slopes but not intercepts  
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "CTQ Total", "AU20", "TimeBeforePeak * AU20", "TimeAfterPeak * AU20", "Baseline * AU20", "CTQ Total * AU20")

colorder <- c("est", "se", "p")

tab_model(mod, title = "AU20 X CTQ Total Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

### AU20 Model X ThreatCompc

```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
mod <- lme(cortvalue ~ 
            timebeforepeak + # Fixed effect
            timeafterpeak + # Fixed effect
            baseline + ThreatCompc + # Fixed effects
            AU20_r*timebeforepeak + AU20_r*timeafterpeak + AU20_r*baseline + AU20_r*ThreatCompc,
            random = ~1|id, # Random slopes but not intercepts 
            corr = corAR1(), # specifies CAR1 structure
            #control =  ctrl, # optimizes model
            method = "REML", # specifies REML fit
            data = cp_long)
summary(mod)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "TimeBeforePeak", "TimeAfterPeak", "Baseline", "ThreatCompc", "AU20", "TimeBeforePeak * AU20", "TimeAfterPeak * AU20", "Baseline * AU20", "ThreatCompc * AU20")

colorder <- c("est", "se", "p")

tab_model(mod, title = "AU20 X ThreatCompc Summary Output", dv.labels = "Cortisol", pred.labels = labels, digits = 3, digits.p = 3, show.ci = FALSE, show.icc=FALSE, show.re.var=FALSE, show.aic=FALSE, show.std = NULL, emph.p = TRUE, show.df = TRUE, string.df="DF", p.val = "wald", show.stat = TRUE, string.stat = "T", show.est = TRUE, show.se = TRUE, string.se="Std Error", show.p = TRUE, string.p="P-value", show.r2 = TRUE, col.order=colorder)

rm(mod)
```

## Logistic Regression

[Link to a guide on logistic regression.](https://stats.idre.ucla.edu/r/dae/logit-regression/)

```{r include=FALSE}
log1 <- glm(Responder ~ cortvalue, data=cp_long, family = "binomial")
summary(log1)

log2 <- glm(Responder ~ cortvalue + gender, data=cp_long, family = "binomial")
summary(log2)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "Cortisol", "Gender")

colorder <- c("est", "se", "p")

title <- c("Cortisol", "Cortisol + Gender")

tab_model(log1, log2, title = "Base Model Logistic Summary Output", auto.label = FALSE, pred.labels = labels, dv.labels = title, show.icc=FALSE, show.re.var=FALSE, string.p="P-value", show.ci=FALSE, show.se=TRUE, string.se="Std Error", show.df = TRUE, string.df="DF", p.val="kr", show.r2=TRUE, col.order=colorder)
```

### Logistic Regression: Emotion

#### Anger

```{r include=FALSE}
anger1 <- glm(Responder ~ anger, data=cp_long, family = "binomial")
summary(anger1)

anger2 <- glm(Responder ~ anger + gender, data=cp_long, family = "binomial")
summary(anger2)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "Anger", "Gender")

colorder <- c("est", "se", "p")

title <- c("Anger", "Anger + Gender")

tab_model(anger1, anger2, title = "Anger Logistic Summary Output", auto.label = FALSE, pred.labels = labels, dv.labels = title, show.icc=FALSE, show.re.var=FALSE, string.p="P-value", show.ci=FALSE, show.se=TRUE, string.se="Std Error", show.df = TRUE, string.df="DF", p.val="kr", show.r2=TRUE, col.order=colorder)
```

#### Fear

```{r include=FALSE}
fear1 <- glm(Responder ~ fear, data=cp_long, family = "binomial")
summary(fear1)

fear2 <- glm(Responder ~ fear + gender, data=cp_long, family = "binomial")
summary(fear2)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "Fear", "Gender")

colorder <- c("est", "se", "p")

title <- c("Fear", "Fear + Gender")

tab_model(fear1, fear2, title = "Fear Logistic Summary Output", auto.label = FALSE, pred.labels = labels, dv.labels = title, show.icc=FALSE, show.re.var=FALSE, string.p="P-value", show.ci=FALSE, show.se=TRUE, string.se="Std Error", show.df = TRUE, string.df="DF", p.val="kr", show.r2=TRUE, col.order=colorder)
```

#### Happiness

```{r include=FALSE}
happiness1 <- glm(Responder ~ happiness, data=cp_long, family = "binomial")
summary(happiness1)

happiness2 <- glm(Responder ~ happiness + gender, data=cp_long, family = "binomial")
summary(happiness2)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "Happiness", "Gender")

colorder <- c("est", "se", "p")

title <- c("Happiness", "Happiness + Gender")

tab_model(happiness1, happiness2, title = "Happiness Logistic Summary Output", auto.label = FALSE, pred.labels = labels, dv.labels = title, show.icc=FALSE, show.re.var=FALSE, string.p="P-value", show.ci=FALSE, show.se=TRUE, string.se="Std Error", show.df = TRUE, string.df="DF", p.val="kr", show.r2=TRUE, col.order=colorder)
```

#### Sadness

```{r include=FALSE}
sadness1 <- glm(Responder ~ sadness, data=cp_long, family = "binomial")
summary(sadness1)

sadness2 <- glm(Responder ~ sadness + gender, data=cp_long, family = "binomial")
summary(sadness2)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "Sadness", "Gender")

colorder <- c("est", "se", "p")

title <- c("Sadness", "Sadness + Gender")

tab_model(sadness1, sadness2, title = "Sadness Logistic Summary Output", auto.label = FALSE, pred.labels = labels, dv.labels = title, show.icc=FALSE, show.re.var=FALSE, string.p="P-value", show.ci=FALSE, show.se=TRUE, string.se="Std Error", show.df = TRUE, string.df="DF", p.val="kr", show.r2=TRUE, col.order=colorder)
```

#### Pain

```{r include=FALSE}
pain1 <- glm(Responder ~ pain, data=cp_long, family = "binomial")
summary(pain1)

pain2 <- glm(Responder ~ pain + gender, data=cp_long, family = "binomial")
summary(pain2)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "Pain", "Gender")

colorder <- c("est", "se", "p")

title <- c("Pain", "Pain + Gender")

tab_model(pain1, pain2, title = "Pain Logistic Summary Output", auto.label = FALSE, pred.labels = labels, dv.labels = title, show.icc=FALSE, show.re.var=FALSE, string.p="P-value", show.ci=FALSE, show.se=TRUE, string.se="Std Error", show.df = TRUE, string.df="DF", p.val="kr", show.r2=TRUE, col.order=colorder)
```

### Logistic Regression: Trauma

#### ThreatZSum

```{r include=FALSE}
ThreatZSum1 <- glm(Responder ~ ThreatZSum, data=cp_long, family = "binomial")
summary(ThreatZSum1)

ThreatZSum2 <- glm(Responder ~ ThreatZSum + gender, data=cp_long, family = "binomial")
summary(ThreatZSum2)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "ThreatZSum", "Gender")

colorder <- c("est", "se", "p")

title <- c("ThreatZSum", "ThreatZSum + Gender")

tab_model(ThreatZSum1, ThreatZSum2, title = "ThreatZSum Logistic Summary Output", auto.label = FALSE, pred.labels = labels, dv.labels = title, show.icc=FALSE, show.re.var=FALSE, string.p="P-value", show.ci=FALSE, show.se=TRUE, string.se="Std Error", show.df = TRUE, string.df="DF", p.val="kr", show.r2=TRUE, col.order=colorder)
```

#### ThreatComp

```{r include=FALSE}
ThreatComp1 <- glm(Responder ~ ThreatComp, data=cp_long, family = "binomial")
summary(ThreatComp1)

ThreatComp2 <- glm(Responder ~ ThreatComp + gender, data=cp_long, family = "binomial")
summary(ThreatComp2)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "ThreatComp", "Gender")

colorder <- c("est", "se", "p")

title <- c("ThreatComp", "ThreatComp + Gender")

tab_model(ThreatComp1, ThreatComp2, title = "ThreatComp Logistic Summary Output", auto.label = FALSE, pred.labels = labels, dv.labels = title, show.icc=FALSE, show.re.var=FALSE, string.p="P-value", show.ci=FALSE, show.se=TRUE, string.se="Std Error", show.df = TRUE, string.df="DF", p.val="kr", show.r2=TRUE, col.order=colorder)
```

#### ThreatCompc

```{r include=FALSE}
ThreatCompc1 <- glm(Responder ~ ThreatCompc, data=cp_long, family = "binomial")
summary(ThreatCompc1)

ThreatCompc2 <- glm(Responder ~ ThreatCompc + gender, data=cp_long, family = "binomial")
summary(ThreatCompc2)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "ThreatCompc", "Gender")

colorder <- c("est", "se", "p")

title <- c("ThreatCompc", "ThreatCompc + Gender")

tab_model(ThreatCompc1, ThreatCompc2, title = "ThreatCompc Logistic Summary Output", auto.label = FALSE, pred.labels = labels, dv.labels = title, show.icc=FALSE, show.re.var=FALSE, string.p="P-value", show.ci=FALSE, show.se=TRUE, string.se="Std Error", show.df = TRUE, string.df="DF", p.val="kr", show.r2=TRUE, col.order=colorder)
```

#### ThreatDepInt

```{r include=FALSE}
ThreatDepInt1 <- glm(Responder ~ ThreatDepInt, data=cp_long, family = "binomial")
summary(ThreatDepInt1)

ThreatDepInt2 <- glm(Responder ~ ThreatDepInt + gender, data=cp_long, family = "binomial")
summary(ThreatDepInt2)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "ThreatDepInt", "Gender")

colorder <- c("est", "se", "p")

title <- c("ThreatDepInt", "ThreatDepInt + Gender")

tab_model(ThreatDepInt1, ThreatDepInt2, title = "ThreatDepInt Logistic Summary Output", auto.label = FALSE, pred.labels = labels, dv.labels = title, show.icc=FALSE, show.re.var=FALSE, string.p="P-value", show.ci=FALSE, show.se=TRUE, string.se="Std Error", show.df = TRUE, string.df="DF", p.val="kr", show.r2=TRUE, col.order=colorder)
```

### Logistic Regression: AUs

#### AU5

```{r include=FALSE}
AU5.1 <- glm(Responder ~ AU05_r, data=cp_long, family = "binomial")
summary(AU5.1)

AU5.2 <- glm(Responder ~ AU05_r + gender, data=cp_long, family = "binomial")
summary(AU5.2)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "AU5", "Gender")

colorder <- c("est", "se", "p")

title <- c("AU5", "AU5 + Gender")

tab_model(AU5.1, AU5.2, title = "AU5 Logistic Summary Output", auto.label = FALSE, pred.labels = labels, dv.labels = title, show.icc=FALSE, show.re.var=FALSE, string.p="P-value", show.ci=FALSE, show.se=TRUE, string.se="Std Error", show.df = TRUE, string.df="DF", p.val="kr", show.r2=TRUE, col.order=colorder)
```

#### AU9

```{r include=FALSE}
AU9.1 <- glm(Responder ~ AU09_r, data=cp_long, family = "binomial")
summary(AU9.1)

AU9.2 <- glm(Responder ~ AU09_r + gender, data=cp_long, family = "binomial")
summary(AU9.2)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "AU9", "Gender")

colorder <- c("est", "se", "p")

title <- c("AU9", "AU9 + Gender")

tab_model(AU9.1, AU9.2, title = "AU9 Logistic Summary Output", auto.label = FALSE, pred.labels = labels, dv.labels = title, show.icc=FALSE, show.re.var=FALSE, string.p="P-value", show.ci=FALSE, show.se=TRUE, string.se="Std Error", show.df = TRUE, string.df="DF", p.val="kr", show.r2=TRUE, col.order=colorder)
```

#### AU14

```{r include=FALSE}
AU14.1 <- glm(Responder ~ AU14_r, data=cp_long, family = "binomial")
summary(AU14.1)

AU14.2 <- glm(Responder ~ AU14_r + gender, data=cp_long, family = "binomial")
summary(AU14.2)
```

```{r echo=FALSE, results = 'asis'}
labels <- c("Intercept", "AU14", "Gender")

colorder <- c("est", "se", "p")

title <- c("AU14", "AU14 + Gender")

tab_model(AU14.1, AU14.2, title = "AU14 Logistic Summary Output", auto.label = FALSE, pred.labels = labels, dv.labels = title, show.icc=FALSE, show.re.var=FALSE, string.p="P-value", show.ci=FALSE, show.se=TRUE, string.se="Std Error", show.df = TRUE, string.df="DF", p.val="kr", show.r2=TRUE, col.order=colorder)
```

## Plots

```{r References, include=FALSE}
#https://quantdev.ssri.psu.edu/tutorials/growth-modeling-chapter-3-linear-growth-models
#http://dpmartin42.github.io/posts/Piecewise-growth

timeticks <- c(0, 3, 15, 25, 30, 35, 40, 45, 60)
timeticks2 <- c(-60, -45, -40, -35, -30, -25, -15, -3, 0, 3, 15, 25, 30, 35, 40, 45, 60)
timeticks3 <- c(4, 5, 6, 7, 8, 9, 10, 11, 12)
```

```{r Descriptive barplot, echo=FALSE, warning=FALSE, message=FALSE, include=FALSE, error=TRUE}
cp_long2 <- cp_long
cp_long2 <- cp_long2[!is.na(cp_long2$peaktime), ]

cp_long2 <- cp_long2 %>% 
  count(cp_long2$peaktime) %>% 
  mutate(perc = n / nrow(cp_long2))

ggplot(cp_long2, aes(x=peaktime, y=perc, fill="red")) + 
  geom_bar(stat = "identity") + ggtitle("When did most people peak?") +
  theme(legend.position = "none") + 
  xlab("Peak Time") + ylab("") + 
  scale_x_discrete(labels=c("0","3","15","25","30","35","40","45","60"))

rm(cp_long2)
```

```{r Descriptive Density plot, echo=FALSE, warning=FALSE, message=FALSE, include=FALSE}
ggplot(cp_long, aes(x=peaktimenum, fill="red")) + 
  geom_density(aes(stat = "identity")) + 
  ggtitle("When did most people peak?") +
  theme(legend.position = "none") + 
  xlab("Peak Time") + ylab("")
```

```{r All cortisol, echo=FALSE, warning=FALSE, message=FALSE, include=TRUE}
ggplot(group_by(cp_long), aes(timetopeak, cortvalue, group=id,color=as.factor(sampletimetopeak))) +
  geom_line(color="#c0c0c0") + 
  geom_point() +
  theme(legend.position="none") + 
  xlab("Sample Time") + ylab("Cortisol") + 
  ggtitle("Everyone's Cortisol, No Modelling") +
  scale_x_continuous(breaks=timeticks2) 
```

```{r Plot mod1 regression line, echo=FALSE, warning=FALSE, message=FALSE, include=TRUE}
ggplot(cp_long, aes(x = timetopeak, y = cortvalue)) +
  geom_line(aes(group = id), color = "gray") + 
  geom_smooth(aes(y=predict(mod1)), size = 2, color = "red", se = TRUE) + 
  xlab("Time to Peak") + ylab("Cortisol") +
  ggtitle("nlme Regression Line") +
  scale_x_continuous(breaks=timeticks2)
```

```{r Everyone gets a line with regression line, include=FALSE, echo=FALSE, warning=FALSE, message=FALSE}
ggplot(cp_long, aes(x = timetopeak, y = cortvalue)) +
  geom_line(aes(color = as.factor(id))) + 
  geom_smooth(aes(y=predict(mod1)), size = 2, color = "red", se = TRUE) +
  xlab("Time to Peak") + ylab("Cortisol") + 
  scale_x_continuous(breaks=timeticks2) +
  theme(legend.position = "none") +
  ggtitle("Everyone's Cortisol with nlme Regression Line")
```

```{r Cortisol growth curve, echo=FALSE, warning=FALSE, message=FALSE, include=TRUE}
ggplot(cp_long, aes(timetopeak, cortvalue)) +
  stat_summary(fun.y=mean, geom="point", size=2) +
  stat_summary(fun.data=mean_se, geom="errorbar", linetype="solid", width=0.6) +
  stat_summary(aes(y=predict(mod1)), fun.y=mean, geom="line", lwd=1.5, col="gray") +
  scale_shape_manual(values=c(16, 17)) +
  labs(x="Time to Peak", y="Cortisol") + 
  ggtitle("Cortisol growth curve") + 
  scale_x_continuous(breaks=timeticks2)
```

```{r Colored by Responder, echo=FALSE, warning=FALSE, message=FALSE, include=FALSE}
cp_long2 <- cp_long
cp_long$Responder2 <- cp_long$Responder

cp_long2$Responder2[cp_long$Responder == "1"] <- "Responder"
cp_long2$Responder2[cp_long$Responder == "0"] <- "Non-Responder"

ggplot(cp_long2, aes(x = timetopeak, y = cortvalue, color=as.factor(Responder2))) +
  geom_point() +
  geom_smooth(aes(y=predict(mod1)), size = 3, color = "red", se = FALSE) + 
  xlab("Time to Peak ") + ylab("Cortisol") +
  scale_x_continuous(breaks=timeticks2) +
  guides(color=guide_legend(title="Cortisol Responsivity")) +
  ggtitle("nlme Regression Line, Colored by Responsivity")

rm(cp_long2)
```
